#!/bin/bash

# Fernando Souza

# Data: 22/08/2023 as 13:38

# Análise do Relatório do Malwarebytes


# Usa no menu de service do Thunar.

# ~/.config/Thunar/uca.xml


# analise-do-relatorio-malwarebytes.sh


# http://www.zago.eti.br/script/sed.html
# http://www.bosontreinamentos.com.br/linux/certificacao-lpic-1/comando-sort-ordenando-dados-em-um-arquivo-de-texto-no-linux-lpi-1/
# http://www.zago.eti.br/script/A-menu-scripts.html
# http://www.bosontreinamentos.com.br/linux/comando-tail-mostrar-o-final-de-um-arquivo-de-texto-no-linux/



relatorio_malwarebytes="$1"

log="/tmp/Malwarebytes.txt"


which yad         || exit 1
which sed         || exit 2


clear


echo "
Malwarebytes
www.malwarebytes.com

-Detalhes do Relatório-
" > "$log"


cat "$relatorio_malwarebytes" | grep "Data da análise:" >> "$log"

cat "$relatorio_malwarebytes" | grep "Hora da análise:" >> "$log"


echo "
-Informações do Software-
" >> "$log"

cat "$relatorio_malwarebytes" | grep "Versão:" >> "$log"
cat "$relatorio_malwarebytes" | grep "Versão de componentes:" >> "$log"
cat "$relatorio_malwarebytes" | grep "Versão do pacote de definições:" >> "$log"



echo "
-Informações do Sistema-
" >> "$log"


cat "$relatorio_malwarebytes" | grep "Sistema operacional:" >> "$log"
cat "$relatorio_malwarebytes" | grep "Processador:" >> "$log"
cat "$relatorio_malwarebytes" | grep "Sistema de arquivos:" >> "$log"


echo "
-Resumo da Análise-
" >> "$log"


cat "$relatorio_malwarebytes" | grep "Objetos verificados:" >> "$log"
cat "$relatorio_malwarebytes" | grep "Ameaças detectadas:" >> "$log"
cat "$relatorio_malwarebytes" | grep "Tempo decorrido:" >> "$log"



# Pega a unidade do disco do Windows (C:\ ou D:\ ...)

unidade=$(cat "$relatorio_malwarebytes" | cut -d, -f2 | grep ":\.*" | tail -n3 | head -n1 | cut -d: -f1)

unidade=$(echo "$unidade" | sed -e 's/\s//')

echo "$unidade"


# ---------------------------------------------------------------------------------------


# if para vogal/consoante


if [[ "$unidade" = [a-zA-Z] ]]; then 

# echo "$unidade é consoante!" | yad --center --title='Relatório do Malwarebytes' --fontname "Sans regular 9" --text-info --wrap --height=1000 --width=1200 2>/dev/null 

ameacas=$(cat "$relatorio_malwarebytes" | grep "$unidade:" | wc -l)


echo "
Ameaças filtradas por "$unidade": no relatório do Malwarebytes: $ameacas
" >> "$log"


echo "

" >> "$log"


cat "$relatorio_malwarebytes" | cut -d , -f2 | grep "$unidade:" | sort >> "$log"



else 

# echo '"'$unidade'" não é consoante!' | yad --center --title='Relatório do Malwarebytes' --fontname "Sans regular 9" --text-info --wrap --height=1000 --width=1200 2>/dev/null 

# exit 

ameacas="0"

echo "
Ameaças filtradas no relatório do Malwarebytes: $ameacas
" >> "$log"



echo "

" >> "$log"


# cat "$relatorio_malwarebytes" | cut -d , -f2 | grep "$unidade:" | sort >> "$log"



fi

# https://www.vivaolinux.com.br/topico/Shell-Script/if-para-vogalconsoante
# https://www.hardware.com.br/comunidade/tr-substituir/869489/


# ---------------------------------------------------------------------------------------



sleep 1

cat "$log" | yad --center --title='Relatório do Malwarebytes' --fontname "Sans regular 9" --text-info --wrap --height=1000 --width=1200 2>/dev/null




# Substituir '\' por '/'  no arquivo "$log"
# =========================================
#
#
# Preciso substituir todas as ocorrências de "barras invertidas" por "barras normais" no arquivo $log. 

# sed -e 's|\\|/|g' "$log"

     
# https://shell-script.yahoogrupos.com.narkive.com/WIgWW6lQ/substituir-por
# https://www.vivaolinux.com.br/topico/Shell-Script/Substituir-string-com-sed



exit 0


